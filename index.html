<!DOCTYPE html>
<head title="Text to Image to Speech">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css"
    rel="stylesheet">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.1/jquery.fancybox.css"
    type="text/css" media="screen" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <style type="text/css">
        img {
            max-height: 200px;
            max-width: 200px;
            min-height: 200px;
            min-width: 200px;
        }
        body{
            padding-top: 60px; 
        }
    </style>
</head>
<body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Pikd</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <li><a href="#about">About</a></li>
              <li><a href="#contact">Contact</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
	<div class="container">
<!--         <label class="checkbox inline"><input id="cat" type="checkbox" value="cat"> Cats</label>
        <label class="checkbox inline"><input id="dog" type="checkbox" value="dog"> Dogs</label>
        <label class="checkbox inline"><input id="dirty" type="checkbox" value="dirty"> NSFW</label>
        <label class="checkbox inline"><input id="super-dirty" type="checkbox" value="super-dirty"> NSFW and make it dirty</label> -->
        <!-- <form class="form-inline"> -->
            <select id="special" class="input-block-level">
              <option data="n">Normal</option>
              <option data="c">Cats</option>
              <option data="d">Dogs</option>
              <option data="x">NSFW</option>
              <option data="xc">NSFW Cats</option>
              <option data="xd">NSFW Dogs</option>
              <option data="xx">NSFW Dirty</option>
            </select>
<!--             <label class="checkbox inline">
              <input type="checkbox" id="nsfw" value="nsfw"> NSFW
            </label> -->
        <!-- </form> -->

		<textarea id="pikd_input" rows="3" class="input-block-level" placeholder="1) Select Type of Result. 2) Type in text and hit Go! 3) Once results are loaded, click on image to see a bigger version. Use arrow keys to navigate the page."></textarea>
		<button id="pikd_submit" class="btn btn-success input-block-level" type="button">Go!</button>
	</div>
	<div class="container">
	    <div class="row-fluid">
	        <div id="galleria"></div>
	    </div>
	</div>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
    <script type="text/javascript" src="galleria-1.2.8.min.js"></script>
    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.1/jquery.fancybox.pack.js"></script>
    <script type="text/javascript" src="speakGenerator.js"></script>
    <script type="text/javascript" src="speakClient.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
			var my_func = function (i) {
				return function(data) {
    				$.each(data.result, function(k,v){
                        if (v !== null && v.length !==0 && v[1] !== null && v[1].length !==0){           
        					$("#cat"+i).append('<a rel="gallery" class="fancybox" href="'+v[1][0][0]+'" alt="'+v[0]+'"><img src="'+v[1][0][1]+'" data-title="'+v[0]+'" alt="'+v[0]+'"></a>');
                        }
                        else {
                            // console.log(i, v);
                        }
    				});
				};
			};
        	$("#pikd_submit").click(function(){
                var substrings =$("#pikd_input").val().replace(/[^A-z0-9 \n\t\r,!:;\?.]/g,"").split(/(?:[.\?!,:;\n\t\r-][ \n\t\r])/); 
        		$("#galleria").empty();
                // console.log(substrings);
        		for (var a =0; a< substrings.length; a++){
                    if (substrings[a] != ""){
            			$("#galleria").append('<span id="cat'+a+'"></span>');
                        var special = "&s="+$("#special").find(":selected").attr("data");
                        if (window.location.hostname === "localhost"){
                            $.getJSON("http://localhost:8000/full-api/?query="+encodeURIComponent(substrings[a].trim())+special+"&callback=?", my_func(a));    
                        }
                        else {
                            $.getJSON("http://larg"+Math.floor(Math.random()*10)+".herokuapp.com/full-api/?query="+encodeURIComponent(substrings[a].trim())+special+"&callback=?", my_func(a));
                        }
                    }
        		}
        		return false;
        	});
    	    Galleria.loadTheme('/themes/classic/galleria.classic.min.js');
    		Galleria.run('#galleria');
    	    Galleria.configure({
			    "imageCrop": true,
			    "transition": 'fade'
			});
    	    // if (Galleria) { console.log("Galleria works!!!");}
            $(".fancybox").fancybox({
                "openEffect": "none",
                "closeEffect": "none",
                "beforeLoad": function () {
                    this.title = $(this.element).find("img").attr("alt");
                },
                "helpers": {
                    title: {
                        type: "outside"
                    }
                },
                "afterLoad": function (current, previous) {
                    // console.info(current.title);
                    speak(current.title);
                }
            });
        });
    </script>
    <div id="audio"></div>
</body>
</html>